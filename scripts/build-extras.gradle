android.applicationVariants.all { variant ->
  variant.outputs.each { output ->
    output.processManifest.doLast {
      [output.processManifest.manifestOutputFile,
       output.processManifest.instantRunManifestOutputFile
      ].forEach({ File manifestOutFile ->
        if (manifestOutFile.exists()) {
          def newFileContents = manifestOutFile.getText('UTF-8').replace('android:exported="true"', 'android:exported="false"');
          manifestOutFile.write(newFileContents, 'UTF-8');
        }
      });
    }
  }
}

